---
title: "Gentrification and Displacement in Buffalo, NY"
author: Nino Martinez
subtitle: Using Census and Open Data to Map Neighborhood Change
---

# Introduction


   In September of 2017, the city of Buffalo announced the reassessment of over 95,000 properties, which will be the first reassessment done since 2010. Officials say, “The purpose of a property reassessment is to establish uniform, fair, and equitable assessments on all real property types” (Slawson, 2017).  The total assessment value of each residential tax parcel often determines how much a homeowner pays in property taxes each year, thus contributes to the development of city infrastructure. In recent years, some residential tax parcels have sold for much more than the assessed value, and are located in neighborhoods where revitalization efforts have taken place. The problem is that in some neighborhoods “property values have shot up so drastically that some homeowners are facing 30% tax increases, or more, compared to when they purchased their affordable homes a decade ago” (Buffalo Rising, 2018).
   
   
  In recent years, some neighborhoods in Buffalo, NY have experienced a substantial increase in the prosperity of the population, others, however, experienced increasing levels of concentrated disadvantage. Here, I use the definition of gentrification given by The Encyclopedia of Housing as “the process by which central urban neighborhoods that have undergone disinvestments and economic decline experience a reversal, reinvestment, and the in-migration of a relatively well-off, middle- and upper middle class population” (Freeman, 2080). Gentrification can displace marginalized populations and most literature document that residential displacement results from increasing rent prices and or home values, no longer affordable for the residing population prior to neighborhood revitalization (LeGates & Hartman 32). 
  
  > Gentrification is the process by which central urban neighborhoods that have undergone disinvestments and economic decline experience a reversal, reinvestment, and the in-migration of a relatively well-off, middle- and upper middle class population. ~ The Encyclopedia of Housing


 Despite the growing demand for up-to-date data that could provide insight into mitigation strategies for the negative consequences of gentrification, only a few studies “attempt to measure gentrification systematically or document the extent and the form of displacement due to gentrification” (Holm & Schulz, 251). Traditional methods of measuring gentrification rely heavily on census data and analyzing key indicators of neighborhood change, such as increasing percentage of white population, higher incomes, and rising rents (Heidkamp & Lucas, 104). This methodology is not able to analyze changing neighborhood dynamics in close-to-real time due to the infrequency of community surveys and the year lag time in results. In addition, as the geographic unit gets smaller, accuracy of the data also diminishes due to higher margins of error, thus blurring both perceived and established neighborhood boundaries in the dynamics of the change. New methods of quantifying changing cities are arising with the “emerging cloud of Big Data” that prove useful to supplement traditional methods to measure gentrification and displacement (Zook et al.) Open data portals provided by local government agencies are also incredibly valuable. These publically available datasets can provide useful information on neighborhood change at the household level. 


  The purpose of this project is to use the city of Buffalo’s Open Data Portal to analyze, visualize, and quantify gentrification based on the sold price of residential tax parcels above the total assessment value, and understand which changing socioeconomic variables play a role in the sale price of residential parcels over its assessed value. Very little academic literature discusses and analyses gentrification in Rust-Belt cities, but what exists says; “In Rust Belt cities like Buffalo, the [displacement] trend plays out differently than in booming coastal cities like San Francisco and New York. But for all these urban centers, increased public and private investment in downtown neighborhoods combined with changing cultural preferences toward urban lifestyles are changing the fabric of these cities in ways scarcely imagined a decade or two ago” (Sherman, 3). Quantifying displacement is problematic due to “lacking the ability to track ‘displacees’” (Atkinson, 149), which happens when data is not available at the individual level to understand migration patterns. Therefore, this project does not empirically analyze displacement, rather, it combines available tax parcel assessment and census data to analyze gentrification, then maps populations that are at the greatest risk of displacement based on potentially rising property taxes due to the city of Buffalo’s reassessment project.
	

> In Rust Belt cities like Buffalo, the [displacement] trend plays out differently than in booming coastal cities like San Francisco and New York. But for all these urban centers, increased public and private investment in downtown neighborhoods combined with changing cultural preferences toward urban lifestyles are changing the fabric of these cities in ways scarcely imagined a decade or two ago.  ~ Danya Sherman

# Data & Methods
1. To Analyse Concentrated Disadvantage for preliminary analysis of gentrifiable census tracts
- **Source:** [Neighborhood Change Database (NCDB)](http://www.geolytics.com/USCensus,Neighborhood-Change-Database-1970-2000,Products.asp)

-*Decline70_00.csv*

-**Source:** [U.S. Census Tiger Data](https://www.census.gov/geo/maps-data/data/tiger.html)

- *Buffalo.shp*
        
-**Source:** [Open data Buffalo Portal](https://data.buffalony.gov/)

- *neighborhoods.shp*

2. To Quantify Gentrification
  - 2018-2019 Assessment Roll (.csv)
  - Neighborhood boundaries (.shp)
3. Census Data
  - 2010 U.S. Census Bureau American Community Survey 5-year Estimates (2006-2010)
  - 2016 U.S. Census Bureau American Community Survey 5-year Estimates (2012-2016)
  - City census tract boundaries (.shp)
  
# Methodology

## Measuring Concentrated Disadvantage

In order to properly quantify gentrification, it is necessary to measure urban decline and concentrated disadvantage within the city historically. “By definition, gentrification is reinvestment in and rebuilding of the physical structures that have undergone a period of disinvestment" (Heidkamp & Lucas, 107). Neighborhoods that experience a period of disinvesment are often concentrated in disadvantage. Circumstances that make success (most often economically) unusually difficult make places disadvantaged, and “the presence of disadvantage weakens a place’s ability to achieve this goal [economic success]” (Weaver et al, 35). When multiple layers of disadvantage occur in a single location, concentrated disadvantage exists (36). By using the geometric mean of five disadvantage variables provided by the NCDB, I calculate concentrate disadvantage (CD) for the years 1970-2000. I use the same variables used by Weaver et al, 2017 in my calculations because all variables are represented as percentages, thus making comparisons across time consistent as they range from a value of 0-100. The equation can be represented as:

**$Gi  = [(Percent Nonwhitei)* (Percent Female Headed Householdsi) * (Percent Unemployedi) * (Percent in Povertyi) * (Percent Low Educationi)]^1/5, i: 1, 2, …, n$** 

```{r message = FALSE, warning=FALSE}
#load all necessary libraries for analysis
library(dplyr)
library(tidyverse)
library(ggplot2)
library(tmap)
library(broom)
library(ggmap)
library(sp)
library(sf) 
library(reshape2)
```

```{r warning=FALSE, message=FALSE}
# For reproducability, set working directory to the data folder of your cloned/downloaded file


decline <- read.csv("Data/Decline70_00.csv")

#Select attributes relevant to 1970 concentrated disadvantage

index70 <- select(decline, GeoID, Pop_70, PerWhite_70, PerFHH_70, Edu08_70, Edu812_70, X25Pop_70, PerPov_70, PerUnEmp_70) 

# Create new columns for percent nonwhite and percent undereducated

geoindex70 <- mutate(index70, 
                     PerLowEdu70 = (Edu08_70 + Edu812_70)/X25Pop_70,
                     PerNonWhite70 = 1 - PerWhite_70) 

# Calculate the geometric index of concentrated disadvantage in 1970 

disadvantage70 <- mutate(geoindex70,
                         index_70 = (PerNonWhite70 * PerFHH_70 * PerUnEmp_70 * PerPov_70 * PerLowEdu70)^(1/5)*100)

# Create new df only the GeoID and the geometric index of concentrated disadvantage for joining and mapping later

conDis_1970 <- select(disadvantage70, GeoID, index_70)

# Make sure it worked

head(conDis_1970)

```
Repeat steps for 1980, 1990, and 2000

```{r message=FALSE, warning=FALSE}
# 1980

index80 <- select(decline, GeoID, Pop_80, PerWhite_80, PerFHH_80, Edu08_80, Edu812_80, X25pop_80, PerPov_80, PerUnemp_80)

geoindex80 <- mutate(index80, 
                     PerLowEdu80 = (Edu08_80 + Edu812_80)/X25pop_80,
                     PerNonWhite80 = 1 - PerWhite_80)

disadvantage80 <- mutate(geoindex80,
                         index_80 = (PerNonWhite80 * PerFHH_80 * PerUnemp_80 * PerPov_80 * PerLowEdu80)^(1/5)*100)

conDis_1980 <- select(disadvantage80, GeoID, index_80)

#1990

index90 <- select(decline, GeoID, Pop_90, PerWhite_90, PerFH_90, Edu08_90, Edu812_90, X25pop_90, PovPer_90, PerUnEmp_90)

geoindex90 <- mutate(index90, 
                     PerLowEdu90 = (Edu08_90 + Edu812_90)/X25pop_90,
                     PerNonWhite90 = 1 - PerWhite_90)

disadvantage90 <- mutate(geoindex90,
                         index_90 = (PerNonWhite90 * PerFH_90 * PerUnEmp_90 * PovPer_90 * PerLowEdu90)^(1/5)*100)

conDis_1990 <- select(disadvantage90, GeoID, index_90)

# 2000

index00 <- select(decline, GeoID, Pop_00, PerWhite_90.1, PerFHH_00, Edu08_00, Edu812_00, X25Pop_00, PerPov_00, PerUnEmp_00)

geoindex00 <- mutate(index00, 
                     PerLowEdu00 = (Edu08_00 + Edu812_00)/X25Pop_00,
                     PerNonWhite00 = 1 - PerWhite_90.1)

disadvantage00 <- mutate(geoindex00,
                         index_00 = (PerNonWhite00 * PerFHH_00 * PerUnEmp_00 * PerPov_00 * PerLowEdu00)^(1/5)*100)

conDis_2000 <- select(disadvantage00, GeoID, index_00)


```
Join all of the conDis_"year" dataframes so there is just one clean file for mapping

```{r}
conDis_70_80 <- full_join(conDis_1970, conDis_1980, "GeoID", "GeoID")
conDis_70_80_90 <- full_join(conDis_70_80, conDis_1990, "GeoID", "GeoID")
conDis_1970_to_2000 <- full_join(conDis_70_80_90, conDis_2000, "GeoID", "GeoID")


#Make sure it worked
head(conDis_1970_to_2000)
```
Join the Concentrated Disadvantage Data with the Spatial Polygon Data to map and caluculate summary values based off of only City of Buffalo census tracts instead of all of erie county 

```{r message=FALSE, warning = FALSE}
buffalo_tracts <- st_read("Data/Buffalo.shp") #read in shapefile
conDis_1970_to_2000$GeoID <- as.character(conDis_1970_to_2000$GeoID) #Change factor to character to join
Buffalo_ConDis <- full_join(buffalo_tracts, conDis_1970_to_2000, by = c("GEOID10" = "GeoID"))
head(Buffalo_ConDis)

conDis_70_mean <- mean(Buffalo_ConDis$index_70)
conDis_80_mean <- mean(Buffalo_ConDis$index_80)
conDis_90_mean <- mean(Buffalo_ConDis$index_90)
conDis_00_mean <- mean(Buffalo_ConDis$index_00)

# Calculate the median

conDis_70_median <- median(Buffalo_ConDis$index_70)
conDis_80_median <- median(Buffalo_ConDis$index_80)
conDis_90_median <- median(Buffalo_ConDis$index_90)
conDis_00_median <- median(Buffalo_ConDis$index_00)

# Create a matrices to plot the change in mean concenctrated disadvantage over time

conDis_matrix <- matrix(nrow = 4, ncol = 3, c("1970","1980","1990","2000",conDis_70_mean,conDis_80_mean, conDis_90_mean,conDis_00_mean,conDis_70_median,conDis_80_median, conDis_90_median,conDis_00_median))
colnames(conDis_matrix) <- c("Year", "Mean_Index", "Median_Index" )

#Convert to dataframe for plotting


conDis_df <- as.data.frame(conDis_matrix)

# Spread data to show mean and median in bar chart

conDis_df.2 <- melt(conDis_df, id.vars='Year')
conDis_df.2

# Change class of value attribute

conDis_df.2$value <- as.numeric(as.character(conDis_df.2$value))

 conDis_plot <- ggplot(data = conDis_df.2, aes(x = Year, y = value, fill = variable)) + geom_bar(stat = "identity", position = "dodge") + ggtitle("Change in Mean and Median Concentrated Disadvantage (CD)", "Buffalo NY 1970-2000 ") + labs(x = "Year", y = "Geometric Index") 


conDis_plot
```

### Preliminary Analysis

From 1970 to 2000, both the average and median geometric index of concentrated disadvantage (CD) nearly doubled, with the most dramatic increase being between the 1970 and 1980. While this shows that disadvantage increased in the city as a whole, it is necessary to analyse the spatial distribution of CD over time within the city as a precursour to the analysis of gentrification. Using the 'tmap' package and the function tmap_arrange, we can evaluate the extent of dispersion in CD.



```{r}
# read in neighborhood shapefile

neighborhoods <- st_read("Data/nbhds.shp")


CD_70_map <-  tm_shape(Buffalo_ConDis) + tm_polygons("index_70", style = "cont",
                                                 palette = "seq",
                                                 n = 7,
                                                 title = "Geometric Index",
                                                 border.alpha = .50) + 
  tm_shape(neighborhoods) + tm_polygons(alpha = 0, border.col = "black") +
  tm_layout(aes.palette = "Reds", legend.outside = TRUE, main.title = "Concentrated Disadvantage 1970", main.title.size = .75)

CD_80_map <-  tm_shape(Buffalo_ConDis) + tm_polygons("index_80", style = "cont",
                                                 palette = "seq",
                                                 n = 7,
                                                 title = "Geometric Index",
                                                 border.alpha = .50) + 
  tm_shape(neighborhoods) + tm_polygons(alpha = 0, border.col = "black") +
  tm_layout(aes.palette = "Reds", legend.outside = TRUE, main.title = "Concentrated Disadvantage 1980", main.title.size = .75)

CD_90_map <-  tm_shape(Buffalo_ConDis) + tm_polygons("index_90", style = "cont",
                                                 palette = "seq",
                                                 n = 7,
                                                 title = "Geometric Index",
                                                 border.alpha = .50) + 
  tm_shape(neighborhoods) + tm_polygons(alpha = 0, border.col = "black") +
  tm_layout(aes.palette = "Reds", legend.outside = TRUE, main.title = "Concentrated Disadvantage 1990", main.title.size = .75)

CD_00_map <-  tm_shape(Buffalo_ConDis) + tm_polygons("index_00", style = "cont",
                                                 palette = "seq",
                                                 n = 7,
                                                 title = "Geometric Index",
                                                 border.alpha = .50) + 
  tm_shape(neighborhoods) + tm_polygons(alpha = 0, border.col = "black") +
  tm_layout(aes.palette = "Reds", legend.outside = TRUE, main.title = "Concentrated Disadvantage 2000", main.title.size = .75)

tmap_arrange(nrow = 2, CD_70_map, CD_80_map, CD_90_map, CD_00_map)
```

CD from 1970 to 2000 spread in an intriguing way, with persistent high indices of disadvantage in the central business district (CBD) and expaning out to the city border on the east and west parts of Buffalo, with compariably low indices in census tracts directly North of the CBD. With the historical context in mind, I evaluate disinvested tracts as any tracts whose geometric index of CD is equal to or greater than the median (CD) of all tracts in the year 2000.

```{r}
conDis_00_median
```
Using the R packages "leaflet", "rgdal", "geojsonio", and "rmapshaper", I created an interactive map that allows users to explore the census tracts within neighborhood boundaries with high levels of CD in order to set the criteria for measuring gentrification.

```{r message=FALSE, warning=FALSE}
# Load necessary packages
library(sp)
library(sf)
library(rgdal)
library(spdplyr)
library(geojsonio)
library(rmapshaper)
library(leaflet)

# Convert sf to sp in order to convert to geojson for interactive mapping with leaflet

Buffalo_ConDis_sp <- as(Buffalo_ConDis, "Spatial") # Concentrated Disadvantage
neighborhoods_sp <- as(neighborhoods, "Spatial") # Neighborhood Boundaries

# Convert to geojson

buffalo_cd_json <- geojson_json(Buffalo_ConDis_sp)
neighborhoods_json <- geojson_json(neighborhoods_sp)

# Simplify the geometry to decrease storage size of spatial object

buffalo_cd_json_simp <- ms_simplify(buffalo_cd_json)
neighborhoods_json_simp <- ms_simplify(neighborhoods_json)

# Write as a geojson to bring back into R for mapping

geojson_write(buffalo_cd_json_simp, file = "city_CD.geojson")
geojson_write(neighborhoods_json_simp, file = "neighborhoods.geojson")

# Read in .geojson to map

city_CD <- geojson_read("city_CD.geojson", what = "sp")
nbhds_json <- geojson_read("neighborhoods.geojson", what = "sp")

# Map for interactive view of concentrated disadvantage

bins <- c(0, 8, 16,24.7, 33, 41, 50.4) # Sets the interval for color scheme
pal_00 <- colorBin("YlOrRd", domain = city_CD$index_00, bins = bins) # Gives seqential color scheme

# Created html popup of index of concentrated disadvantage

labels_00 <- sprintf(
  "<strong>%g index of CD</strong>",
  city_CD$index_00
) %>% lapply(htmltools::HTML)

# Create leaflet map to label by geometric index

CD_Map_2000 <- leaflet() %>% setView(-78.8784, 42.8864, 10.9) %>% addTiles() %>%
  addPolygons(data = nbhds_json, fillOpacity = 0, weight = 3, opacity = 1) %>%
  addPolygons(data = city_CD, fillColor = ~pal_00(index_00),
  weight = 0.5,
  opacity = 0.5,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5,
    bringToFront = TRUE),
  label = labels_00,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto")) 

# Create leaflet map to label by neighborhood

CD_nbhd_2000 <- leaflet() %>% setView(-78.8784, 42.8864, 10.7) %>% addTiles() %>%
  addPolygons(data = city_CD, fillColor = ~pal_00(index_00),
              weight = 2,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.5) %>%
  addPolygons(data = nbhds_json, fillOpacity = 0, weight = 1.2,
                          label = nbhds_json$nbhdname) %>%
  addLegend(pal = pal_00, values = city_CD$index_00, opacity = 0.5, title = "Concentrated Disadvantage (%)",
                position = "bottomleft")

```


### Explore Buffalo, NY's Areas of Concentrated Disadvantage by Geometric Index (Year 2000)


```{r}
CD_Map_2000
```



### Explore Buffalo, NY's Areas of Concentrated Disadvantage by Neighborhood (Year 2000)



```{r}
CD_nbhd_2000
```



## Measuring Gentrification: Traditional Methodology
  
<br>While traditional methods of measuring gentrification rely heavily upon the use of analyzing key indicators of gentrification, such as increasing percentage of white population, higher incomes, and rents (Heidkamp & Lucas, 104). This methodology is not able to analyze changing neighborhood dynamics in close-to-real time due to the infrequency of community surveys and the year lag time of results. In addition, as the geographic unit gets smaller, accuracy of the data also diminishes due to higher margins of error, thus blurring both perceived and established neighborhood boundaries as well as the dynamics of change. New methods of quantifying changing cities arose from the “emerging cloud of Big Data”, and prove useful to supplement traditional methods of measuring gentrification and displacement (Zook et al., 2). Open data portals provided by local government agencies are also incredibly valuable. These publically available datasets can provide useful information on neighborhood change at the individual level.</br>

In order to measure gentrification, I analyse changes in key variables provided by the U.S. Census Bureau that are used consistently in academic literature (Atkinson 2000, Heidcamp & Lucas 2006, Freeman & Braconi 2004, Holm & Schulz 2017). These variables come from the U.S. Census Bureau's American Community Survey 5-year estimates. I examine change from the 2010 (2006-2010 estimates) and 2016 (2012-2016 estimates). This process involves a lot of data transformation in RStudio, I chose not to use the R package "tidyverse" due to the specific variables needed for analysis and the lack of variable full descriptions within the package. I instead download the required datasets from the US Census Bureau [factfinder](https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml), and use the meta data to then filter the data by columns for variable selection. Due to the time involved in filtering the data by the metadata, I select variables of interest for future research in addition to the variables for this project alone.

### Economic Variables

```{r}
# Read in all economic variables for 2010
economic_10 <- read.csv("Data/economic_10.csv", skip = 1)

#Filter variables by column number based on metadata

key_economic_10 <- economic_10[,c(2,3,38, 39, 86, 87, 110, 111, 248, 249, 204, 205, 478:479)]

# Make sure the column names are selected correctly

colnames(key_economic_10)

# Create vector for new column names 

economic_names_10 <- c("GEOID10", 
                    "Census_Tract", 
                    "Per_Unemp10", 
                    "Per_Unemp10_MOE",
                    "Per_Public_Trans_10",
                    "Per_Public_Trans10_MOE", 
                    "Per_Occ_Mgmt_10",
                    "Per_Occ_Mgmt10_MOE",
                    "Median_HH_Income_10",
                    "Median_HH_Income_10_MOE",
                    "Num_Households_10",
                    "Num_Households_10_MOE",
                    "Per_Pov_10",
                    "Per_Pov_10_MOE")

# Assign the names to the dataframe

colnames(key_economic_10) <- economic_names_10

# 2016

economic_16 <- read.csv("Data/econ16.csv")

key_economic_16 <- economic_16[,c(2,3,38, 39, 86, 87, 110, 111, 248, 249, 204, 205, 478:479)]
colnames(key_economic_16)


economic_names_16 <- c("GEOID10", 
                    "Census_Tract", 
                    "Per_Unemp16", 
                    "Per_Unemp16_MOE",
                    "Per_Public_Trans_16",
                    "Per_Public_Trans16_MOE", 
                    "Per_Occ_Mgmt_16",
                    "Per_Occ_Mgmt16_MOE",
                    "Median_HH_Income_16",
                    "Median_HH_Income_16_MOE",
                    "Num_Households_16",
                    "Num_Households_16_MOE",
                    "Per_Pov_16",
                    "Per_Pov_16_MOE")
colnames(key_economic_16) <- economic_names_16
```
```{r warning = FALSE, message= FALSE}
# Change values to numbers

# 2010

key_economic_10$Median_HH_Income_10<-as.numeric(as.character(key_economic_10$Median_HH_Income_10))
key_economic_10$Num_Households_10 <- as.numeric(as.character(key_economic_10$Num_Households_10))
key_economic_10$Per_Unemp10 <- as.numeric(as.character(key_economic_10$Per_Unemp10))
key_economic_10$Per_Public_Trans_10<-as.numeric(as.character(key_economic_10$Per_Public_Trans_10))
key_economic_10$Per_Occ_Mgmt_10 <- as.numeric(as.character(key_economic_10$Per_Occ_Mgmt_10))
key_economic_10$Per_Pov_10 <- as.numeric(as.character(key_economic_10$Per_Pov_10))

# 2016
key_economic_16$Median_HH_Income_16<-as.numeric(as.character(key_economic_16$Median_HH_Income_16))
key_economic_16$Num_Households_16 <- as.numeric(as.character(key_economic_16$Num_Households_16))
key_economic_16$Per_Unemp16 <- as.numeric(as.character(key_economic_16$Per_Unemp16))
key_economic_16$Per_Public_Trans_16 <- as.numeric(as.character(key_economic_16$Per_Public_Trans_16))
key_economic_16$Per_Occ_Mgmt_16 <- as.numeric(as.character(key_economic_16$Per_Occ_Mgmt_16))
key_economic_16$Per_Pov_16 <- as.numeric(as.character(key_economic_16$Per_Pov_16))
```

```{r warning = FALSE}
#Combine economic data for 2010 and 2016
# Change to character to join

key_economic_16$GEOID10 <- as.character(key_economic_16$GEOID10)
key_economic_10$GEOID10 <- as.character(key_economic_10$GEOID10)
all_years_economic <- full_join(key_economic_10, key_economic_16, by = c("GEOID10" = "GEOID10")) 

#Calculate changes in economic indicators

economic_change <- all_years_economic %>% mutate(Unemp_Chg = Per_Unemp16 - Per_Unemp10,
                                                 Pub_Tran_Chg =Per_Public_Trans_16-Per_Public_Trans_10,
                                                 Per_Occ_Mgt_Chg = Per_Occ_Mgmt_16 - Per_Occ_Mgmt_10,
                                                 Med_Inc_Chg = Median_HH_Income_16-Median_HH_Income_10,
                                                 Num_House_Chg = Num_Households_16 - Num_Households_10,
                                                 Per_Pov_Chg = Per_Pov_16 - Per_Pov_10)

```


### Education Variables

```{r warning = FALSE, message=FALSE}
# Education 2010

edu_10 <- read.csv("Data/edu_10.csv")

key_edu_10 <- edu_10[,c(2,3,34,35,40,41,46,47,88,89,94,95,112,113)]

colnames(key_edu_10)


edu_names_10 <- c("GEOID10", 
                    "Census_Tract", 
                    "Total_25Plus_10", 
                    "25Plus_MOE_10",
                     "less_9_10",
               "less_9_moe_10",
                     "nd_9_12th_10",
               "nd_9_12_moe_10",
                    "Per_BachelorsPlus_10",
                    "Bachelors_Plus_MOE_10",
               "num_25_34yo_10",
               "num_25_34yo_moe_10",
               "num_35_44yo_10",
               "num_35_44yo_moe_10") 
                    
colnames(key_edu_10) <- edu_names_10

# Sum population 25 and over without a highschool diploma or equivalency and pop 25-44

key_edu_10$less_9_10 <- as.numeric(as.character(key_edu_10$less_9_10))
key_edu_10$nd_9_12th_10 <- as.numeric(as.character(key_edu_10$nd_9_12th_10))

key_edu_10 <- key_edu_10 %>% mutate(per_no_hs_diploma_10 = less_9_10 + nd_9_12th_10,
                                    pop_25_44_10 = num_25_34yo_10 + num_35_44yo_10) #remember to still calculate the percentage once tables are joined



# Education 2016

edu_16 <- read.csv("Data/edu_16.csv", skip = 1)
key_edu_16 <- edu_16[,c(2,3,64,65,78,79,88,89,174,175,184,185,220,221)]

colnames(key_edu_16)


edu_names_16 <- c("GEOID10", 
                 "Census_Tract", 
                 "Total_25Plus_16", 
                 "25Plus_MOE_16",
                 "less_9_16",
                 "less_9_moe_16",
                 "nd_9_12th_16",
                 "nd_9_12_moe_16",
                 "Per_BachelorsPlus_16",
                 "Bachelors_Plus_MOE_16",
                 "num_25_34yo_16",
                 "num_25_34yo_moe_16",
                 "num_35_44yo_16",
                 "num_35_44yo_moe_16")  

colnames(key_edu_16) <- edu_names_16

# Sum population 25 and over without a highschool diploma or equivalency and pop 25-44

key_edu_16$less_9_16 <- as.numeric(as.character(key_edu_16$less_9_16))
key_edu_16$nd_9_12th_16 <- as.numeric(as.character(key_edu_16$nd_9_12th_16))
key_edu_16$num_25_34yo_16 <- as.numeric(as.character(key_edu_16$num_25_34yo_16))
key_edu_16$num_35_44yo_16 <- as.numeric(as.character(key_edu_16$num_35_44yo_16))

key_edu_16 <- key_edu_16 %>% mutate(per_no_hs_diploma_16 = less_9_16 + nd_9_12th_16,
                                    num_25_44yo_16 = num_25_34yo_16 + num_35_44yo_16) # Remeber to calculate percent when tables are joined

# Sum population 25-44

# # Calculate Education change (Change in percentage of population over 25 w/o a bachelors degree)

# Change characters to numbers

key_edu_10$Per_BachelorsPlus_10 <- as.numeric(as.character(key_edu_10$Per_BachelorsPlus_10))
key_edu_16$Per_BachelorsPlus_16 <- as.numeric(as.character(key_edu_16$Per_BachelorsPlus_16))

#Join edu 10 and 16 df's

#Combine economic data for 2010 and 2016
key_edu_10$GEOID10 <- as.character(key_edu_10$GEOID10)
key_edu_16$GEOID10 <- as.character(key_edu_16$GEOID10)
all_years_education<- full_join(key_edu_10, key_edu_16, by = c("GEOID10" = "GEOID10"))

#Calculate percentage change of population 25 and over with a bachelors degree or higher 

edu_change <- all_years_education %>% mutate(college_change = Per_BachelorsPlus_16 - Per_BachelorsPlus_10,
                                             no_diploma_change = per_no_hs_diploma_16 - per_no_hs_diploma_10)

```

### Race Variables

```{r message = FALSE, warning=FALSE}
## Race 2010


race_10 <- read.csv("Data/race2_10.csv", skip = 1)

key_race_10 <- race_10[,c(2:17,26,27)]

colnames(key_race_10)


race_names_10 <- c("GEOID10", 
               "Census_Tract", 
               "total_pop_10", 
               "total_pop_moe_10",
               "not_hisp_10",
               "not_hisp_moe_10",
               "white_10",
               "white_MOE_10",
               "black_10",
               "black_moe_10",
               "native_10",
               "native_moe_10",
               "asian_10",
               "asian_moe_10",
               "pac_isl_10",
               "pac_isl_moe_10",
               "hisp_10",
               "hisp_moe_10") 

colnames(key_race_10) <- race_names_10


#Calculate percentages

key_race_10 <- key_race_10 %>% mutate(per_white_10 = (white_10/total_pop_10)*100,
                                      per_black_10 = (black_10/total_pop_10)*100,
                                      per_asian_10 = (asian_10/total_pop_10)*100,
                                      per_native_10 = (native_10/total_pop_10)*100,
                                      per_pac_isl_10 = (pac_isl_10/total_pop_10)*100,
                                      per_hisp_10 = (hisp_10/total_pop_10)*100)

# Race 2016


race_16 <- read.csv("Data/race2_16.csv", skip = 1)
colnames(race_16)
key_race_16 <- race_16[,c(2:17,26,27)]

colnames(key_race_16)


race_names_16 <- c("GEOID10", 
                   "Census_Tract", 
                   "total_pop_16", 
                   "total_pop_moe_16",
                   "not_hisp_16",
                   "not_hisp_moe_16",
                   "white_16",
                   "white_MOE_16",
                   "black_16",
                   "black_moe_16",
                   "native_16",
                   "native_moe_16",
                   "asian_16",
                   "asian_moe_16",
                   "pac_isl_16",
                   "pac_isl_moe_16",
                   "hisp_16",
                   "hisp_moe_16") 

colnames(key_race_16) <- race_names_16


key_race_16 <- key_race_16 %>% mutate(per_white_16 = (white_16/total_pop_16)*100,
                                      per_black_16 = (black_16/total_pop_16)*100,
                                      per_asian_16 = (asian_16/total_pop_16)*100,
                                      per_native_16 = (native_16/total_pop_16)*100,
                                      per_pac_isl_16 = (pac_isl_16/total_pop_16)*100,
                                      per_hisp_16 = (hisp_16/total_pop_16)*100)

# # Calculate change in ethnic composition


#Join race 10 and 16 df's

#Combine race data for 2010 and 2016
key_race_10$GEOID10 <- as.character(key_race_10$GEOID10)
key_race_16$GEOID10 <- as.character(key_race_16$GEOID10)
all_years_race<- full_join(key_race_10, key_race_16, by = c("GEOID10" = "GEOID10"))



#Calculate change in ethnic composition population from 2010-2016 

race_change <- all_years_race %>% mutate(white_change = per_white_16 - per_white_10,
                                         black_change = per_black_16 - per_black_10,
                                         native_change = per_native_16 - per_native_10,
                                         asian_change = per_asian_16 - per_asian_10,
                                         pac_isl_change = per_pac_isl_16 - per_pac_isl_10)

```

### Housing Variables

```{r message=FALSE, warning=FALSE}
# Housing 2010

house_10 <- read.csv("Data/house_10.csv", skip = 1)

key_house_10 <- house_10[,c(2:5,10,11,14,15,16,17,20,21,180:187,200:203,216:223,352,353,452:455,496,497,528,529,560:563)]

colnames(key_house_10)

house_names_10 <- c("GEOID10", 
                   "Census_Tract", 
                   "total_units_10", 
                   "total_units_moe_10",
                   "per_occ_10",
                   "per_occ_moe_10",
                   "per_vac_10",
                   "per_vac_moe_10",
                   "own_vac_rate_10",
                   "own_vac_rate_moe_10",
                   "rent_vac_rate_10",
                   "rent_vac_rate_moe_10",
                   "own_occ_num_10",
                   "own_occ_num_moe_10",
                   "own_occ_per_10",
                   "own_occ_per_moe_10",
                   "rent_occ_num_10",
                   "rent_occ_num_moe_10",
                   "rent_occ_per_10",
                   "rent_occ_per_moe_10",
                   "move_05plus_num_10",
                   "move_05plus_num_moe_10",
                   "move_05plus_per_10",
                   "move_05plus_per_moe_10",
                   "move_70_79_num_10",
                   "move_70_79_num_moe_10",
                   "move_70_79_per_10",
                   "move_70_79_per_moe_10",
                   "move_69earl_num_10",
                   "move_69earl_num_moe_10",
                   "move_69earl_per_10",
                   "move_69earl_per_moe_10",
                   "median_home_value_10",
                   "median_home_value_moe_10",
                   "SMOCAPI_35plus_num_10",
                   "SMOCAPI_35plus_num_moe_10",
                   "SMOCAPI_35plus_per_10",
                   "SMOCAPI_35plus_per_moe_10",
                   "occ_units_pay_rent_10",
                   "occ_units_pay_rent_moe_10",
                   "median_rent_10",
                   "median_rent_moe_10",
                   "GRAPI_35plus_num_10",
                   "GRAPI_35plus_num_moe_10",
                   "GRAPI_35plus_per_10",
                   "GRAPI_35plus_per_moe_10") 


colnames(key_house_10) <- house_names_10


# Calculate number of long-standing homeowners  (ie 2010 census 1979 or earlier (31+ years))

key_house_10$move_70_79_per_10 <- as.numeric(as.character(key_house_10$move_70_79_per_10))
key_house_10$move_69earl_per_10 <- as.numeric(as.character(key_house_10$move_69earl_per_10))

key_house_10 <- key_house_10 %>% mutate(move_in_30plus_yrs_num = move_70_79_num_10 +move_69earl_num_10,
                                        move_in_30plus_yrs_per = move_70_79_per_10 + move_69earl_per_10)


# House 2016

house_16 <- read.csv("Data/house_16.csv", skip = 1)

key_house_16 <- house_16[,c(2:5,10,11,14,15,16,17,20,21,184:191,204:211,220:227,356,357,460:463,504,505,536:537,568:571)]

colnames(key_house_16)

house_names_16 <- c("GEOID10", 
                    "Census_Tract", 
                    "total_units_16", 
                    "total_units_moe_16",
                    "per_occ_16",
                    "per_occ_moe_16",
                    "per_vac_16",
                    "per_vac_moe_16",
                    "own_vac_rate_16",
                    "own_vac_rate_moe_16",
                    "rent_vac_rate_16",
                    "rent_vac_rate_moe_16",
                    "own_occ_num_16",
                    "own_occ_num_moe_16",
                    "own_occ_per_16",
                    "own_occ_per_moe_16",
                    "rent_occ_num_16",
                    "rent_occ_num_moe_16",
                    "rent_occ_per_16",
                    "rent_occ_per_moe_16",
                    "move_15plus_num_16",
                    "move_15plus_num_moe_16",
                    "move_15plus_per_16",
                    "move_15plus_per_moe_16",
                    "move_10_14_num_16",
                    "move_10_14_num_moe_16",
                    "move_10_14_per_16",
                    "move_10_14_per_moe_16",
                    "move_80_89_num_16",
                    "move_80_89_num_moe_16",
                    "move_80_89_per_16",
                    "move_80_89_per_moe_16",
                    "move_79earl_num_16",
                    "move_79earl_num_moe_16",
                    "move_79earl_per_16",
                    "move_79earl_per_moe_16",
                    "median_home_value_16",
                    "median_home_value_moe_16",
                    "SMOCAPI_35plus_num_16",
                    "SMOCAPI_35plus_num_moe_16",
                    "SMOCAPI_35plus_per_16",
                    "SMOCAPI_35plus_per_moe_16",
                    "occ_units_pay_rent_16",
                    "occ_units_pay_rent_moe_16",
                    "median_rent_16",
                    "median_rent_moe_16",
                    "GRAPI_35plus_num_16",
                    "GRAPI_35plus_num_moe_16",
                    "GRAPI_35plus_per_16",
                    "GRAPI_35plus_per_moe_16") 


colnames(key_house_16) <- house_names_16


# Calculate number of long-standing homeowners (ie 2016 census 1989, 27+ years or more) and moved in last 6 years

key_house_16$move_80_89_per_16 <- as.numeric(as.character(key_house_16$move_80_89_per_16))
key_house_16$move_79earl_per_16 <- as.numeric(as.character(key_house_16$move_79earl_per_16))
key_house_16$move_15plus_per_16 <- as.numeric(as.character(key_house_16$move_15plus_per_16))
key_house_16$move_10_14_per_16 <- as.numeric(as.character(key_house_16$move_10_14_per_16))

key_house_16 <- key_house_16 %>% mutate(move_in_27plus_yrs_num_16 = move_80_89_num_16 + move_79earl_num_16,
                                        move_in_27plus_yrs_per_16 = move_80_89_per_16 + move_79earl_per_16,
                                        move_recent_num_16 = move_15plus_num_16 + move_10_14_num_16,
                                        move_recent_per_16 = move_15plus_per_16 + move_10_14_per_16)


# Change factor (percent) variables to numeric

# House 2010

key_house_10$per_occ_10 <- as.numeric(as.character(key_house_10$per_occ_10))
key_house_10$per_vac_10 <- as.numeric(as.character(key_house_10$per_vac_10))
key_house_10$own_vac_rate_10 <-as.numeric(as.character(key_house_10$own_vac_rate_10))
key_house_10$rent_vac_rate_10 <-as.numeric(as.character(key_house_10$rent_vac_rate_10))
key_house_10$own_occ_per_10 <-as.numeric(as.character(key_house_10$own_occ_per_10))
key_house_10$rent_occ_per_10 <-as.numeric(as.character(key_house_10$rent_occ_per_10))
key_house_10$move_05plus_per_10 <-as.numeric(as.character(key_house_10$move_05plus_per_10))
key_house_10$SMOCAPI_35plus_per_10 <-as.numeric(as.character(key_house_10$SMOCAPI_35plus_per_10))
key_house_10$median_home_value_10 <-as.numeric(as.character(key_house_10$median_home_value_10))
key_house_10$GRAPI_35plus_per_10 <-as.numeric(as.character(key_house_10$GRAPI_35plus_per_10))
key_house_10$GRAPI_35plus_per_10 <-as.numeric(as.character(key_house_10$GRAPI_35plus_per_10))
key_house_10$median_rent_10 <- as.numeric(as.character(key_house_10$median_rent_10))
# House 2016

key_house_16$per_occ_16 <- as.numeric(as.character(key_house_16$per_occ_16))
key_house_16$per_vac_16 <- as.numeric(as.character(key_house_16$per_vac_16))
key_house_16$own_vac_rate_16 <-as.numeric(as.character(key_house_16$own_vac_rate_16))
key_house_16$rent_vac_rate_16 <-as.numeric(as.character(key_house_16$rent_vac_rate_16))
key_house_16$own_occ_per_16 <-as.numeric(as.character(key_house_16$own_occ_per_16))
key_house_16$rent_occ_per_16 <-as.numeric(as.character(key_house_16$rent_occ_per_16))
key_house_16$move_15plus_per_16 <-as.numeric(as.character(key_house_16$move_15plus_per_16))
key_house_16$SMOCAPI_35plus_per_16 <-as.numeric(as.character(key_house_16$SMOCAPI_35plus_per_16))
key_house_16$median_home_value_16 <-as.numeric(as.character(key_house_16$median_home_value_16))
key_house_16$GRAPI_35plus_per_16 <-as.numeric(as.character(key_house_16$GRAPI_35plus_per_16))
key_house_16$GRAPI_35plus_per_16 <-as.numeric(as.character(key_house_16$GRAPI_35plus_per_16))
key_house_16$median_rent_16 <- as.numeric(as.character(key_house_16$median_rent_16))


#Join house 10 and 16 df's

key_house_10$GEOID10 <- as.character(key_house_10$GEOID10)
key_house_16$GEOID10 <- as.character(key_house_16$GEOID10)
all_years_house<- full_join(key_house_10, key_house_16, by = c("GEOID10" = "GEOID10"))

#Calculate important indicators of change

house_change <- all_years_house %>% mutate(rent_change = median_rent_16 - median_rent_10,
                                      home_value_change = median_home_value_16-median_home_value_10,
                                          rent_occ_change_per = rent_occ_per_16 - rent_occ_per_10,
                                          own_occ_change_per = own_occ_per_16 - own_occ_per_10,
                               GRAPI_35plus_change_per = GRAPI_35plus_per_16 - GRAPI_35plus_per_10,
                         SMOCAPI_35plus_change_per = SMOCAPI_35plus_per_16 - SMOCAPI_35plus_per_10)

class(house_change$median_home_value_10)
View(house_change)
```

### Combining all variables from change dataframes

``` {r message=FALSE, warning = FALSE}
econ_edu_join <- full_join(economic_change, edu_change, by = c("GEOID10", "GEOID10"))
econ_edu_race_join <- full_join(econ_edu_join, race_change, by = c("GEOID10", "GEOID10"))
all_gent_var <- full_join(econ_edu_race_join, house_change, by = c("GEOID10", "GEOID10"))

# Calculate percent of people aged 25-44

all_gent_var_new <- all_gent_var %>% mutate(per_25_44_10 = (pop_25_44_10/total_pop_10)*100,
                                            per_25_44_16 = (num_25_44yo_16/total_pop_16)*100,
                                            per_25_44_change = per_25_44_16 - per_25_44_10,
                                            total_pop_chg = total_pop_16 - total_pop_10)

# Select only change variables

gent_change_df <- all_gent_var_new %>% select("GEOID10", contains("change"), contains("chg"))

# Make new df for all 2010 variables with Margins of error for easy access

gent_variables_2010_df <- all_gent_var_new %>% select("GEOID10", contains("_10"), contains("10"))

# Make new df for all 2016 variables with Margins of error for easy access

gent_variables_2016_df <- all_gent_var_new %>% select("GEOID10", contains("_16"), contains("16"))

# Combine new data frames with city of buffalo census tracts to exclude census tracts outside of city limits

buffalo_change_df <- full_join(buffalo_tracts, gent_change_df, by = c("GEOID10"= "GEOID10")) %>% filter(NAME10 != "NA")


buffalo_change_df[is.na(buffalo_change_df)] <- 0

buffalo_2010_df <- full_join(buffalo_tracts, gent_variables_2010_df, by = c("GEOID10"= "GEOID10")) %>% filter(NAME10 != "NA")

buffalo_2016_df <- full_join(buffalo_tracts, gent_variables_2016_df, by = c("GEOID10"= "GEOID10")) %>% filter(NAME10 != "NA")

```

The key variables that I will consider to measure gentrification are based on the historical context of Buffalo after rapid deindustrialization and suburbanization that left the inner-city impoverished and segregated. Changes in the key variables within neighborhoods that experienced a period of disinvestment, represented by concentrated disadvantage in 2000, between 2010 and 2016 establish the gentrification frontier. The gentrification frontier will be categotized as such:

1. Not gentrified - poor
  - Census tracts that remained consistent or have seen decreases in affluent populations
2. Not gentrified - high status
  - Census tracts that may have seen increases in affluent populations but have historically low concentrated disadvantage.
3. Potentially gentrifying
  - Disinvested census tracts with some increase in affluent populations
4. Gentrifying
  - Disinvested census tracts with inreases in at least half of the variables that represented     gentrfication
5. Gentrified
  - Census tracts that have seen increases in all of the gentrification variables.
  
The gentrification variables considered for the regression analysis are :

1. Change in the percentage of white population (increase)
2. Change in the percentage of the population living below the poverty line (decrease)
3. Change in the household median income (increase)
4. Change in the percentage of the population 25 years of age or older with at least a bachelors degree (increase)
5. Change in the percentage of the population living in owner occupied housing (increase)
6. Change in the percentage of the population employed in managerial, technical, and professional occupations (increase)
7. Change in total population (increase)
8. Change in percentage of population ages 25-44 years of age (increase)
9. Change in median rent (increase)

The change in all of these variables in each census tract must be considered in comparision to the average change of the City of Buffalo as a whole.

```{r message = FALSE}

# Calculate city change averages in key gentrification variables



mean_white_chg <- mean(buffalo_change_df$white_change)
mean_pov_chg <- mean(buffalo_change_df$Per_Pov_Chg)
mean_income_chg <- mean(buffalo_change_df$Med_Inc_Chg)
mean_college_chg <- mean(buffalo_change_df$college_change)
mean_own_occ_chg <- mean(buffalo_change_df$own_occ_change_per)
mean_prof_occ_chg <- mean(buffalo_change_df$Per_Occ_Mgt_Chg)
mean_total_pop_chg <- mean(buffalo_change_df$total_pop_chg)
mean_adult_chg <- mean(buffalo_change_df$per_25_44_change)
mean_rent_chg <- mean(buffalo_change_df$rent_change)

# create a matrix of the variables 

Var_desc_vector <- c("Change in the percentage of white population (increase)","Change in the percentage of the population living below the poverty line (decrease)","Change in the household median income (increase)","Change in the percentage of the population 25 years of age or older with at least a bachelors degree (increase)","Change in the percentage of the population living in owner occupied housing (increase)","Change in the percentage of the population employed in managerial, technical, and professional occupations (increase)","Change in total population (increase)","Change in percentage of population ages 25-44 years of age (increase)","Change in median rent (increase)")


mean_change_matrix <- matrix(nrow = 9, ncol = 2, c(Var_desc_vector, mean_white_chg, mean_pov_chg, mean_income_chg, mean_college_chg, mean_own_occ_chg, mean_prof_occ_chg, mean_total_pop_chg, mean_adult_chg, mean_rent_chg))

colnames(mean_change_matrix) <- c("Variable", "Mean Change (2010-2016)")

mean_change_df <- as.data.frame(mean_change_matrix)



# Make into a nice html table  

library(knitr)
library(kableExtra)

kable(mean_change_df) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))


```

From 2010 to 2016, according to the U.S. Census Bureau American Community Survey data, the city of Buffalo as a whole has seen an average increase in six out of the nine variables included in the gentrification assessment, only seeing a decrease in the percentage of white population, percentage of the population living in owner occupied housing, and change in total population. While it is apparent that, according to census data and traditional methods of measuring gentrification, the City of Buffalo is gentrifying as whole. It is imperative to analyze the spatial mismatch of disadvantage and affluence within city neighborhoods before making conclusions about the state of the city.

```{r message = FALSE, warning=FALSE}
# Convert sf to sp in order to convert to geojson for interactive mapping with leaflet

buffalo_change_sp <- as(buffalo_change_df, "Spatial") # Neighborhood change


# Convert to geojson

buffalo_change_json <- geojson_json(buffalo_change_sp)


# Simplify the geometry to decrease storage size of spatial object

buffalo_change_json_simp <- ms_simplify(buffalo_change_json)


# Write as a geojson to bring back into R for mapping

geojson_write(buffalo_change_json_simp, file = "city_change.geojson")


# Read in .geojson to map

city_change <- geojson_read("city_change.geojson", what = "sp")


# Map for interactive view of concentrated disadvantage

summary(city_change$white_change) # Understand range of data
white_bins <- c(-30, -15, -7, 0, 7, 15, 30) # Sets the interval for color scheme based on range
white_pal <- colorBin("RdYlBu", domain = city_change$white_change, bins = white_bins)

labels_white <- sprintf(
  "<strong>%g Percent Change</strong>",
  city_change$white_change
) %>% lapply(htmltools::HTML)

summary(city_change$Per_Pov_Chg) #can use same bins
pov_pal <- colorBin("RdYlBu", domain = city_change$white_change, bins = white_bins, reverse = TRUE) # invert for decreasing being better

labels_pov <- sprintf(
  "<strong>%g Percent Change</strong>",
  city_change$Per_Pov_Chg
) %>% lapply(htmltools::HTML)

summary(city_change$Med_Inc_Chg)

income_bins <- c(-15000, -5000, 0, 5000, 15000, 30000, 55000) 
income_pal <- colorBin("RdYlBu", domain = city_change$Med_Inc_Chg, bins = income_bins) 

labels_income <- sprintf(
  "<strong>%g Dollar Change</strong>",
  city_change$Med_Inc_Chg
) %>% lapply(htmltools::HTML)

summary(city_change$college_change)

college_bins <- c(-70, -30, -15, 0, 5, 15, 30)
college_pal <- colorBin("RdYlBu", domain = city_change$college_change, bins = college_bins) 

labels_college <- sprintf(
  "<strong>%g Percent Change</strong>",
  city_change$college_change
) %>% lapply(htmltools::HTML)

summary(city_change$own_occ_change_per)

homeowners_bins <- c(-20, -10, -5, 0, 5, 10, 15)
homeowners_pal <- colorBin("RdYlBu", domain = city_change$own_occ_change_per, bins = homeowners_bins) 

labels_homeowners <- sprintf(
  "<strong>%g Percent Change</strong>",
  city_change$own_occ_change_per
) %>% lapply(htmltools::HTML)

summary(city_change$Per_Occ_Mgt_Chg)

occupation_bins <- c(-35, -15, -5, 0, 10, 20, 30)
occupation_pal <- colorBin("RdYlBu", domain = city_change$Per_Occ_Mgt_Chg, bins = occupation_bins) 

labels_occupation <- sprintf(
  "<strong>%g Percent Change</strong>",
  city_change$Per_Occ_Mgt_Chg
) %>% lapply(htmltools::HTML)

summary(city_change$total_pop_chg)

pop_bins <- c(-1500, -750, -325, 0, 750, 1500)
pop_pal <- colorBin("RdYlBu", domain = city_change$total_pop_chg, bins = pop_bins) 

labels_pop <- sprintf(
  "<strong>%g Amount Change</strong>",
  city_change$total_pop_chg
) %>% lapply(htmltools::HTML)

summary(city_change$per_25_44_change)

adult_bins <- c(-13, -7, -3, 0, 3, 7, 13)
adult_pal <- colorBin("RdYlBu", domain = city_change$per_25_44_change, bins = adult_bins) 

labels_adult <- sprintf(
  "<strong>%g Percent Change</strong>",
  city_change$per_25_44_change
) %>% lapply(htmltools::HTML)

summary(city_change$rent_change)

rent_bins <- c(-250, -100, -50, 0, 50, 100, 300)
rent_pal <- colorBin("RdYlBu", domain = city_change$rent_change, bins = rent_bins) 

labels_rent <- sprintf(
  "<strong>%g Dollar Change</strong>",
  city_change$rent_change
) %>% lapply(htmltools::HTML)


# Create leaflet map to toggle between layers of gentrification variables

nbhd_chg_map <- leaflet() %>% setView(-78.8784, 42.8864, 10.9) %>% addTiles() %>%
  addPolygons(data = city_change, fillColor = ~white_pal(white_change),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_white,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "White Population") %>%
    addPolygons(data = city_change, fillColor = ~pov_pal(Per_Pov_Chg),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_pov,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "Poverty") %>%
      addPolygons(data = city_change, fillColor = ~pov_pal(Per_Pov_Chg),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_pov,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "Poverty") %>%
      addPolygons(data = city_change, fillColor = ~income_pal(Med_Inc_Chg),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_income,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "Median Income") %>%
      addPolygons(data = city_change, fillColor = ~college_pal(college_change),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_college,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "College Grads") %>%
      addPolygons(data = city_change, fillColor = ~homeowners_pal(own_occ_change_per),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_homeowners,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "Home Owners") %>%
  addPolygons(data = city_change, fillColor = ~occupation_pal(Per_Occ_Mgt_Chg),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_occupation,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "Professional Occupation") %>%
  addPolygons(data = city_change, fillColor = ~pop_pal(total_pop_chg),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_pop,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "Total Population") %>%
  addPolygons(data = city_change, fillColor = ~adult_pal(per_25_44_change),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_adult,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "Adult Population") %>%
  addPolygons(data = city_change, fillColor = ~rent_pal(rent_change),
  weight = 0.5,
  opacity = 0.7,
  color = "white",
  dashArray = "3",
  fillOpacity = 0.5,
  highlight = highlightOptions(
    weight = 5,
    color = "#666",
    dashArray = "",
    fillOpacity = 0.5),
  label = labels_rent,
  labelOptions = labelOptions(
    style = list("font-weight" = "normal", padding = "3px 8px"),
    textsize = "15px",
    direction = "auto"),
  group = "Median Rent") %>%
    addPolygons(data = nbhds_json, fillOpacity = 0, weight = 1, opacity = 1, group = "Neighborhood",
              label = nbhds_json$nbhdname) %>%
  addLayersControl(overlayGroups = c("White Population", "Poverty", "Median Income", "College Grads", "Home Owners", "Professional Occupation", "Total Population", "Adult Population", "Median Rent", "Neighborhoods"),options = layersControlOptions(collapsed = FALSE))
```


### Explore Gentrification Map 

This interactive map allows you to view the key variables of neighborhood change that indicate gentrification in Buffalo NY, simply toggle between layers to view the change. Neighborhoods in blue have encountered the greatest change in terms of gentrification variables while neighborhoods in orange/red have seen a decrease in most variables.

```{r}
nbhd_chg_map
```

## Measuring Gentrification: Traditional Methodology with Open Data Assessment

<br>In recent years, some residential tax parcels have sold for much more than the assessed value and are located in neighborhoods where revitalization efforts have taken place. The total assessment value of each residential tax parcel determines how much a homeowner pays in property taxes each year, thus contributes to the development of city infrastructure. The purpose of this project is to use the city of Buffalo’s Open Data Portal to analyze and visualize gentrification based on the sold price of residential tax parcels above the total assessment value and understand which changing socioeconomic variables play the largest role the amount sold price was over the assessment value.  By using R Studio, I will filter the data set to only include residential tax parcels that were sold between 2010 and 2016 for higher than the assessed value, which I will then group by census tract to portray descriptive statistics for each neighborhood. By using census data provided by the U.S. Census Bureau’s American Community Survey 5-year estimates for 2010 and 2016, I will analyze the socioeconomic change of key indicators of gentrification documented in the literature, also at the census tract level. In order to model this relationship, I will use a multivariate regression model to test the strength of the relationships.</br>

## 


# Results

Show tables, plots, etc. and describe them.



# Conclusions

What have you learned?  Are there any broader implications?

# References 

Freeman, Lance (2009). Neighbourhood Diversity, Metropolitan Segregation and Gentrification: What Are the Links in the US? Urban Studies 46(10), 2079-2101.

Holm, Andrej & Schulz, Guido (2017). Gentrimap: A Model for Measuring Gentrification and Displacement. Gentrification and Resistance: Researching Displacement Processes and Adaption Strategies. Springer VS, 251-277

Heidkamp, Patrick C & Lucas, Susan (2006). Finding the Gentrification Frontier Using Census Data: The Case of Portland, Maine. Urban Geography 27(2), 101-125.

LeGates, R., & Hartman, C. (1982). Gentrification-Caused Displacement. The Urban Lawyer, 14(1), 31-55. 

Zook et al (2017). Big Data and the City. Handbook of Urban Geography, 1-12.

